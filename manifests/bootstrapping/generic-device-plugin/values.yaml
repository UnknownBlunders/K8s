controllers:
  generic-device-plugin:
    type: daemonset
    strategy: RollingUpdate
    containers:
      generic-device-plugin:
        image:
          repository: ghcr.io/squat/generic-device-plugin
          tag: latest@sha256:8e74085edef446b02116d0e851a7a5576b4681e07fe5be75c4e5f6791a8ad0f7
        args:
          - --config=/config/config.yaml
        ports:
          - containerPort: 8080
            name: http
        resources:
          requests:
            cpu: 10m
            memory: 20Mi
          limits:
            memory: 20Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          capabilities: { drop: ["ALL"] }
persistence:
  config:
    type: configMap
    name: generic-device-plugin
    globalMounts:
      - path: /config
        readOnly: true
  dev:
    type: hostPath
    hostPath: /dev
    globalMounts:
      - path: /dev
  device-plugin:
    type: hostPath
    hostPath: /var/lib/kubelet/device-plugins
    globalMounts:
      - path: /var/lib/kubelet/device-plugins

configMaps:
  config:
    enabled: true
    data:
      config.yaml: |-
        log-level: info
        domain: devices.blunders.me
        devices:
          - name: ups-usb
            groups:
              - usb:
                - vendor: "051D"
                  product: "0002"
